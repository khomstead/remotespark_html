svGlobal.RdpPlayer=function(){function g(){d=lastTime=totalTime=0;timeOut=rdp=null;f=!1;a.state=a.CLOSED;d=lastTime=totalTime=0;timeOut=rdp=null;f=!1}function i(a,b){return(a[b]&255)<<24|(a[b+1]&255)<<16|(a[b+2]&255)<<8|a[b+3]&255}function l(c,b){if(a.state!=a.PLAYING)d-=8;else{var e=c.target.result;if(a.state==a.PLAYING){var m=f?0:b-lastTime;lastTime=b;timeOut=setTimeout(function(){if(a.onprogress)a.onprogress(b,totalTime);a.state==a.PLAYING?(a.onmessage({data:e}),d+=e.byteLength,h(8,j)):d-=8},m)}}}
function j(c){if(a.state==a.PLAYING)if(c=new Int8Array(c.target.result),8!=c.length){if(a.onprogress)a.onprogress(totalTime,totalTime);a.close();console.log("ssssss xxx len="+c.length)}else{var b=i(c,0),e=i(c,4);1>e&&(console.error("Duration:"+e),e=1);a.state==a.PLAYING&&(d+=8,h(b,function(a){l(a,e)}))}}function n(c){var b=new Int8Array(c.target.result);if(82!=b[0]&&68!=b[1]&&80!=b[2]&&86!=b[3])alert(__svi18n.player.fmterror);else{var c=(b[4]&255)<<8|b[5]&255,e=(b[6]&255)<<8|b[7]&255,f=(b[8]&255)<<
8|b[9]&255,g=b[10]&255;lastTime=0;totalTime=i(b,19)<<32|i(b,23);console.log("total time:"+totalTime);(b=svManager.getInstance())&&b.close();rdp=new svGlobal.Rdp(a,e,f,g);rdp.displayMsg=!1;b=new svGlobal.LocalInterface;b.setReadOnly(!0);b.hideWhenClose=!1;rdp.addSurface(b);rdp.run();if(a.onopen)a.onopen();if(a.onopened)a.onopened({width:e,height:f,color:g,version:c,length:totalTime,size:k.size});d=64;h(8,j)}}function h(c,b){if(a.state!=a.PLAYING){if(8==c)return;d-=8}var e=k.slice(d,d+c);reader=new FileReader;
reader.onload=b;reader.readAsArrayBuffer(e)}var a=this,d=lastTime=totalTime=0,k=timeOut=rdp=reader=null,f=terminated=!1;this.PLAYING=0;this.PAUSED=1;this.state=this.CLOSED=3;this.close=function(){console.log("Player closed");try{if(a.onclose&&(a.onclose({code:0,reason:""}),a.onclose=null),rdp)rdp.close(),rdp=null}finally{g()}};this.setSource=function(c){if(reader){try{reader.abort()}catch(b){}reader=null}a.state==a.PLAYING?(a.state==a.CLOSED,terminated=!0,timeOut&&(clearTimeout(timeOut),timeOut=null),
a.close()):(g(),terminated=!1);if(c){if(!("slice"in c)&&(c.slice=c.webkitSlice||c.mozSlice,!("slice"in c))){alert(__svi18n.file.slice);return}k=c}else alert(__svi18n.player.noinput)};this.send=function(){};this.play=function(){a.state=a.PLAYING;if(0==d){var c=function(){d=0;h(64,n)};terminated?setTimeout(c,888):c()}else h(8,j)};this.scan=function(a){f=a};this.pause=function(){a.state=a.PAUSED}};
