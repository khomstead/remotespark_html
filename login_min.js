function login(a){function e(b){for(;b.hasChildNodes();)b.removeChild(b.firstChild)}hi5.tool.disableInput();var d=!1;(function(b,a){window.__sparkUser=null;var c=new hi5.WebSocket(b);c.onclose=function(){d||(alert(__svi18n.errorCode.connection),showLogDlg());d=!1;hi5.tool.enableInput()};c.onmessage=function(b){d=!0;b=JSON.parse(b.data);b.error||c.send("A1"+navigator.userAgent);a(b);c.close()};return!1})(a,function(b){hi5.tool.enableInput();if(b.error)alert(__svi18n.errorCode["S"+b.name]);else{document.getElementById("frmLogin").style.display=
"none";document.getElementById("frmConn").style.display="block";var d=document.getElementById("programs");e(d);var c=b.servers;if(!b.accessNotInList){var a=document.getElementById("anyconn");a&&(a.style.display="none")}window.__sparkUser={session:b.session,account:document.getElementById("user").value,gateway:document.getElementById("gateway").value,servers:c};b=c.length;if(!(1>b))for(a=0;a<b;a++){var i=c[a].server,j=c[a].id,i=c[a].displayName||j||i,k=c[a].icon;k||(k="rdp32.png");var h=document.createElement("div");
h.className="icon";var g=document.createElement("img");g.src=k;g.id=j;g.alt=j;g.title=i;g.style.cursor="pointer";g.onclick=function(a){connect(a.target.id)};h.appendChild(g);h.appendChild(document.createElement("br"));h.appendChild(document.createTextNode(i));d.appendChild(h)}}});return!1}
function connect(a){var e=window.__sparkUser,d=e.servers,b=d.length;e.server=null;window.sparkGateway=e.gateway;for(var f=0;f<b;f++){var c=d[f];if(a==c.id){c=connvertServer(c);c.gateway=e.gateway;c.session=e.session;c.account=e.account;e.server=c;b=c.color;a=window.innerWidth;d=window.innerHeight;c.width=a;c.height=d;b||(b=16);c.width=a;c.height=d;c.color=b;break}}e.server?0<e.server.exe.length&&hi5.browser.isMultitask?openRail():window.open("rdpdirect.html"):alert("Not a valid server")}
function startExitingApp(a){function e(b){d.addSurface(b);d.startExitingApp(a)}var d=svManager.getInstance();window.svOnSurfaceReady=e;window.open("rail.html").svOnSurfaceReady=e;var b=document.getElementById(a),f=b.parentNode;f.removeChild(b);f=f.parentNode;0==f.getElementsByTagName("input").length&&(f.dismiss(),d.checkRemaining(2E3))}
function openRail(){function a(a){d.addSurface(a);d.running()?d.startApp(e.exe,e.args,""):d.run()}var e=window.__sparkUser.server,d=svManager.getInstance();null==d&&(d=new svGlobal.Rdp2(e),d.sessionTimeout=9E5);window.svOnSurfaceReady=a;window.open("rail.html").svOnSurfaceReady=a}function openDesktop(){window.open("rdp.html?gateway="+document.getElementById("gateway").value)}
function showLogDlg(){window.__sparkUser=null;var a=document.getElementById("frmLogin");a.elements.pwd.value="";a.style.display="block";document.getElementById("frmConn").style.display="none";(a=svManager.getInstance())&&a.running()&&a.close()}window.addEventListener("load",function(){document.getElementById("user").focus()},!1);
